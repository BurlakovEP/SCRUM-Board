"use strict";window.onload=function(){var e,t,o,n,r,l,c,a,p=document.querySelector(".page"),_=document.querySelector(".template-popup"),u=document.querySelector(".template-note"),i=document.querySelectorAll(".board__cell_body")[0],s=document.querySelectorAll(".board__cell_body")[1],d=document.querySelectorAll(".board__cell_body")[2],f=document.querySelectorAll(".footer__count");function g(e,t){var o=e-.5+Math.random()*(t-e+1);return Math.round(o)}function m(){var e=this,t=_.content.cloneNode(!0).firstElementChild,o=this.parentNode.classList[1].split("_")[2];p.append(t),t.querySelector(".popup__name").innerHTML="Deleting note",t.querySelector(".popup__main").innerHTML="Really want to delete note?",t.querySelector(".popup__main").className="popup__main popup__main_small";var n=t.querySelector(".popup__content").offsetHeight/2;t.querySelector(".popup__content").style.top="calc(40% - "+n+"px)",t.querySelector(".popup__button-close").onclick=function(){t.remove()},t.querySelector(".popup__button-cancel").onclick=function(){t.remove()},t.querySelector(".popup__button-ok").onclick=function(){e.parentNode.remove(),document.querySelector(".footer__count_"+o).innerHTML--,q(),t.remove()}}function y(e){var t=this,o=_.content.cloneNode(!0).firstElementChild;p.append(o),o.querySelector(".popup__name").innerHTML="Changing note",o.querySelectorAll(".popup__headline")[0].innerHTML="Change note priority",o.querySelectorAll(".popup__headline")[1].innerHTML="Change note text";var n=o.querySelector(".popup__content").offsetHeight/2;o.querySelector(".popup__content").style.top="calc(40% - "+n+"px)";var r=document.querySelector(".popup__text-field"),l=document.querySelectorAll(".note");r.onfocus=function(){this.classList.contains("popup__text-field_warning")&&this.classList.remove("popup__text-field_warning")};for(var c=o.querySelectorAll(".popup__toggle"),a=this.parentNode.classList[1].split("_")[2],u=0;u<c.length;u++)c[u].value===a&&(c[u].checked=!0);for(var i=0;i<l.length;i++)o.querySelector(".popup__text-field").value=this.parentNode.querySelector(".note__sticker").innerHTML;o.querySelector(".popup__button-close").onclick=function(){o.remove()},o.querySelector(".popup__button-cancel").onclick=function(){o.remove()},o.querySelector(".popup__button-ok").onclick=function(){if(""===r.value||!/[^\s]/.test(r.value))return r.classList.toggle("popup__text-field_warning"),!1;t.parentNode.querySelector(".note__sticker").innerHTML=o.querySelector(".popup__text-field").value;for(var e=0;e<c.length;e++)c[e].checked&&(t.parentNode.className="note note_priority_"+c[e].value+" note_state_default",document.querySelector(".footer__count_"+c[e].value).innerHTML++,document.querySelector(".footer__count_"+a).innerHTML--,q());o.remove()}}e=JSON.parse(localStorage.getItem("toDo")),t=JSON.parse(localStorage.getItem("inProgress")),o=JSON.parse(localStorage.getItem("done")),n=JSON.parse(localStorage.getItem("footerCountLow")),r=JSON.parse(localStorage.getItem("footerCountMiddle")),l=JSON.parse(localStorage.getItem("footerCountHigh")),document.querySelectorAll(".board__cell_body")[0].innerHTML=e,document.querySelectorAll(".board__cell_body")[1].innerHTML=t,document.querySelectorAll(".board__cell_body")[2].innerHTML=o,document.querySelectorAll(".footer__count")[0].innerHTML=n,document.querySelectorAll(".footer__count")[1].innerHTML=r,document.querySelectorAll(".footer__count")[2].innerHTML=l,document.querySelector(".footer__date").innerHTML=(c="date",a=new Date,"date"===c?a.toLocaleDateString():"time"===c?a.toLocaleTimeString():"full"===c?a.toLocaleDateString()+" "+a.toLocaleTimeString():void 0),p.onkeydown=p.onkeyup=function(e){var t=document.querySelector(".popup");if(!t)return;var o=t.querySelector(".popup__text-field");"Escape"===e.key&&t.remove();if(" "===e.key)return!!o&&(!!o.matches(":focus")&&void 0);if("Enter"===e.key)if(o){if(o.matches(":focus"))return;o&&""===o.value?(e.preventDefault(),o.classList.add("popup__text-field_warning")):o&&""!==o.value&&(t.querySelector(".popup__button-ok").onclick(),t.remove())}else t.querySelector(".popup__button-ok").onclick(),t.remove()},document.querySelector(".create-note").onclick=function(){var o=_.content.cloneNode(!0).firstElementChild;p.append(o),o.querySelector(".popup__name").innerHTML="Creating note",o.querySelectorAll(".popup__headline")[0].innerHTML="Select note priority",o.querySelectorAll(".popup__headline")[1].innerHTML="Enter note text";var e=o.querySelector(".popup__content").offsetHeight/2;o.querySelector(".popup__content").style.top="calc(40% - "+e+"px)";var n=document.querySelector(".popup__text-field"),r=document.querySelectorAll(".popup__toggle");n.onfocus=function(){this.classList.contains("popup__text-field_warning")&&this.classList.remove("popup__text-field_warning")},o.querySelector(".popup__button-close").onclick=function(){o.remove()},o.querySelector(".popup__button-cancel").onclick=function(){o.remove()},o.querySelector(".popup__button-ok").onclick=function(){if(""===n.value||!/[^\s]/.test(n.value))return n.classList.add("popup__text-field_warning"),!1;for(var e=0;e<r.length;e++)if(r[e].checked){var t=u.content.cloneNode(!0).firstElementChild;t.className+=" note_priority_"+r[e].value,t.className+=" note_state_default",t.querySelector(".note__tape").className+=" note__tape_angle_"+g(1,3),t.querySelector(".note__sticker").className+=" note__sticker_angle_"+g(1,3),t.querySelector(".note__sticker").innerHTML=n.value,document.querySelector(".footer__count_"+r[e].value).innerHTML++,i.append(t),q(),o.remove()}}},document.querySelector(".clean-board").onclick=function(){var t=_.content.cloneNode(!0).firstElementChild;p.append(t),t.querySelector(".popup__name").innerHTML="Cleaning board",t.querySelector(".popup__main").innerHTML="Really want to clear board?",t.querySelector(".popup__main").className="popup__main popup__main_small";var e=t.querySelector(".popup__content").offsetHeight/2;t.querySelector(".popup__content").style.top="calc(40% - "+e+"px)",t.querySelector(".popup__button-close").onclick=function(){t.remove()},t.querySelector(".popup__button-cancel").onclick=function(){t.remove()},t.querySelector(".popup__button-ok").onclick=function(){for(;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)s.removeChild(s.firstChild);for(;d.firstChild;)d.removeChild(d.firstChild);localStorage.clear();for(var e=0;e<f.length;e++)f[e].innerHTML="0",q();t.remove()}};var S={};function v(e){S.clone.hidden=!0;var t=document.elementFromPoint(e.clientX,e.clientY);return S.clone.hidden=!1,null===t?null:t.closest(".board__cell_body")}function q(){var e=JSON.stringify(i.innerHTML),t=JSON.stringify(s.innerHTML),o=JSON.stringify(d.innerHTML),n=JSON.stringify(f[0].innerHTML),r=JSON.stringify(f[1].innerHTML),l=JSON.stringify(f[2].innerHTML);localStorage.setItem("toDo",e),localStorage.setItem("inProgress",t),localStorage.setItem("done",o),localStorage.setItem("footerCountLow",n),localStorage.setItem("footerCountMiddle",r),localStorage.setItem("footerCountHigh",l)}document.onmousedown=function(e){var t=e.target.closest(".note__button_delete"),o=e.target.closest(".note__button_edit");if(e.target===t||e.target.parentNode===t)t.addEventListener("click",m);else if(e.target===o||e.target.parentNode===o)o.addEventListener("click",y);else{if(1!==e.which)return;var n=e.target.closest(".note");if(!n)return;S.note=n,S.parent=n.parentNode,S.nextSibling=n.nextSibling,S.downX=e.pageX,S.downY=e.pageY,S.shiftX=e.clientX-S.note.getBoundingClientRect().left+parseInt(getComputedStyle(S.note).marginTop),S.shiftY=e.clientY-S.note.getBoundingClientRect().top+parseInt(getComputedStyle(S.note).marginLeft),S.clone=S.note.cloneNode(!0),S.target=null}},document.onmousemove=function(e){if(S.note){var t=e.pageX-S.downX,o=e.pageY-S.downY;if(!(Math.abs(t)<3&&Math.abs(o)<3))return document.body.style.overflow="hidden",function(){S.note.classList.toggle("note_state_default",!1),S.note.classList.toggle("note_state_invisible",!0);var e=S.clone;e.classList.toggle("note_state_default",!1),e.classList.toggle("note_state_draggable",!0),document.body.appendChild(e)}(),S.clone.style.left=e.pageX-S.shiftX+"px",S.clone.style.top=e.pageY-S.shiftY+"px",function(e){var t=v(e);S.target!==t&&(S.target&&(S.target.className="board__cell board__cell_body board__cell_state_default"),S.target=t,S.target&&S.target!==S.note.parentNode&&(S.target.className="board__cell board__cell_body board__cell_state_droppable"))}(e),!1}},document.onmouseup=function(e){S.clone&&function(e){var t=v(e);t===S.note.parentNode?(S.note.remove(),S.parent.insertBefore(S.clone,S.nextSibling),S.clone.removeAttribute("style"),S.clone.classList.toggle("note_state_draggable",!1),S.clone.classList.toggle("note_state_default",!0)):(t.append(S.clone),S.clone.classList.toggle("note_state_draggable",!1),S.clone.classList.toggle("note_state_default",!0),S.clone.removeAttribute("style"),S.note.remove(),q())}(e),S={};for(var t=document.querySelectorAll(".board__cell_body"),o=0;o<t.length;o++)t[o].classList.toggle("board__cell_state_droppable",!1),t[o].classList.toggle("board__cell_state_default",!0)}};